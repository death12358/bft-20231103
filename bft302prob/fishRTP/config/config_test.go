package config

import (
	"fmt"
	"testing"

	"gopkg.in/yaml.v3"
)

func Test_NewRTPConfigManager(t *testing.T) {
	js := `[{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":21,"single_bet":1,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":2,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":5,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":11,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":16,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":22,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":36,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":76,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":136,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":176,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":336,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":760,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1360,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1760,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":3360,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":10,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":20,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":50,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":110,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":160,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":220,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":360,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":760,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1360,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1760,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":3360,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":7600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":13600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":17600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":33600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":100,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":200,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":500,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1100,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":1600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":2200,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":3600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":7600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":13600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":17600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":33600,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":76000,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":136000,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":176000,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1},{"game_info":{"country_id":1,"platform_id":1,"vendor_id":15,"game_id":28,"single_bet":336000,"game_name":"遊戲","platform_name":"包網","vendor_name":"代理","country_name":"幣別"},"config_id":1}]`
	configJs := `{"1":{"limit_config":{"base_bet":50,"sys_rtp_limit_enabled":true,"sys_rtp_limit":10000,"daily_sys_loss_limit_enabled":false,"daily_sys_loss_limit":400000,"sys_limit_prob":1,"daily_player_profit_limit_enabled":false,"daily_player_profit_limit":30000,"monthly_player_profit_limit_enabled":false,"monthly_player_profit_limit":100000,"player_limit_prob":1},"sys_config":{"expected_rtp":9700,"base_prob":1,"spin_trigger":0,"re_spin_max":10,"player_config":{"expected_rtp":9700,"enabled":false,"spin_trigger":0,"range_upper_limit":9950,"range_lower_limit":5000,"rtp_range":{"UpperRange":[{"No":1,"Offset":10,"ProbType":1},{"No":2,"Offset":20,"ProbType":1},{"No":3,"Offset":30,"ProbType":2},{"No":4,"Offset":40,"ProbType":2},{"No":5,"Offset":50,"ProbType":2}],"LowerRange":[{"No":1,"Offset":10,"ProbType":1},{"No":2,"Offset":20,"ProbType":1},{"No":3,"Offset":30,"ProbType":1},{"No":4,"Offset":40,"ProbType":1},{"No":5,"Offset":50,"ProbType":1}]}},"new_player_config":{"enabled":true,"prob":2,"experience_prob":3,"spin_limit":300,"profit_limit":300,"experience_limit":2,"experience_loss_limit":30,"experience_cd_time":30,"range_upper_limit":9750,"range_lower_limit":0,"experience_buffer_spin_min":1,"experience_buffer_spin_max":20},"bonus_config":{"enabled":false,"prob":5,"rtp_limit":10000,"spin_trigger":100,"player_loss_trigger":50,"sys_cd_spin":200,"player_cd_spin":50,"buffer_spin_min":5,"buffer_spin_max":20},"high_score_config":{"enabled":true,"prob":4,"rtp_limit":10000,"spin_trigger":3000,"player_loss_trigger":4000,"sys_cd_spin":20000,"player_cd_spin":3000,"buffer_spin_min":30,"buffer_spin_max":200}}}`
	var c []GameConfig
	var rtpC map[int]RTPConfig
	yaml.Unmarshal([]byte(js), &c)
	yaml.Unmarshal([]byte(configJs), &rtpC)
	configManage, err := NewRTPConfigManager("127.0.0.1", "", 6379)
	if err != nil {
		fmt.Println(err.Error())
		return
	}
	rc := GameRTPConfig{
		GameConfigs: c,
		RTPConfigs:  rtpC,
	}
	err = configManage.SetRTPConfig(rc)
	if err != nil {
		fmt.Println(err.Error())
	}
}
